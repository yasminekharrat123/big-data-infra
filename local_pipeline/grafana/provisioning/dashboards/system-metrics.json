{
  "uid": "system-overview",
  "title": "System Overview Dashboard",
  "timezone": "browser",
  "schemaVersion": 37,
  "version": 2,
  "refresh": "10s",
  "panels": [
    {
      "type": "timeseries",
      "title": "CPU Usage (avg)",
      "gridPos": { "x": 0, "y": 0, "w": 12, "h": 9 },
      "targets": [
        {
          "refId": "A",
          "datasource": { "type": "influxdb", "uid": "influxdb_metrics" },
          "query": "from(bucket: \"system-metrics\") |> range(start: -48h) |> filter(fn: (r) => r._measurement == \"cpu_usage\" and r._field == \"value\")"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "percent" } }
    },
    {
      "type": "timeseries",
      "title": "Memory Usage (avg)",
      "gridPos": { "x": 12, "y": 0, "w": 12, "h": 9 },
      "targets": [
      {
        "refId": "B",
        "datasource": { "type": "influxdb", "uid": "influxdb_metrics" },
        "query": "from(bucket: \"system-metrics\") |> range(start: -48h) |> filter(fn: (r) => r._measurement == \"mem_usage\" and r._field == \"value\")"
      }
      ],
      "fieldConfig": { "defaults": { "unit": "Mb" } }
    },
    {
      "type": "timeseries",
      "title": "Disk Usage (avg)",
      "gridPos": { "x": 0, "y": 9, "w": 12, "h": 9 },
      "targets": [
      {
        "refId": "C",
        "datasource": { "type": "influxdb", "uid": "influxdb_metrics" },
        "query": "from(bucket: \"system-metrics\") |> range(start: -48h) |> filter(fn: (r) => r._measurement == \"disk_usage\" and r._field == \"value\")"
      }
      ],
      "fieldConfig": { "defaults": { "unit": "Gb" } }
    },
    {
      "type": "barchart",
      "title": "Log Categories (Count)",
      "gridPos": { "x": 12, "y": 9, "w": 12, "h": 9 },
      "targets": [
        {
          "refId": "D",
          "datasource": { "type": "influxdb", "uid": "influxdb_logs" },
          "query": "from(bucket: \"system-logs\") |> range(start: -1h) |> filter(fn: (r) => r._measurement == \"log_status_counts\" and r._field == \"count\")"
        }
      ]
    },
    {
      "type": "table",
      "title": "Daily Report - Hosts Overview",
      "gridPos": { "x": 0, "y": 18, "w": 24, "h": 10 },
      "targets": [
        {
          "refId": "E",
          "datasource": { "type": "elasticsearch", "uid": "es_reports" },
          "timeField": "timestamp",
          "query": "*",
          "bucketAggs": [
            {
              "id": "1",
              "type": "terms",
              "field": "host.keyword",
              "settings": {
                "size": 10,
                "order": "desc",
                "orderBy": "_term"
              }
            }
          ],
          "metrics": [
            { "id": "2", "type": "avg", "field": "avg_cpu" ,"alias": "Average CPU usage" },
            { "id": "3", "type": "avg", "field": "avg_mem" ,"alias": "Average Mem usage" },
            { "id": "4", "type": "avg", "field": "avg_disk","alias": "Average Disk usage" },
            { "id": "5", "type": "avg", "field": "stddev_cpu","alias": "CPU Standard deviation" },
            { "id": "6", "type": "avg", "field": "stddev_mem","alias": "MEM Standard deviation" },
            { "id": "7", "type": "avg", "field": "stddev_disk", "alias": "Disk Standard deviation" },
            { "id": "8", "type": "avg", "field": "status_counts_2xx", "alias": "200 OK" },
            { "id": "9", "type": "avg", "field": "status_counts_3xx", "alias": "300" },
            { "id": "10", "type": "avg", "field": "status_counts_4xx", "alias": "400 ERR" },
            { "id": "11", "type": "avg", "field": "status_counts_5xx", "alias": "500 ERR" },
            { "id": "12", "type": "avg", "field": "status_counts_unknown", "alias": "unknown Error" }
            
          ]
        }
      ]
    },
    {
  "type": "table",
  "title": "Log Alerts",
  "gridPos": { "x": 0, "y": 28, "w": 24, "h": 10 },
  "targets": [
    {
      "refId": "F",
      "datasource": { "type": "elasticsearch", "uid": "es_log_alerts" },
      "timeField": "timestamp",
      "query": "*:*",
      "queryType": "lucene",
      "metrics": [
        {
          "type": "raw_document",
          "id": "1"
        }
      ],
      "bucketAggs": []
    }
  ],
  "options": {
    "showHeader": true,
    "cellHeight": "sm",
    "footer": { "show": false }
  },
  "transformations": [
    {
      "id": "extractFields",
      "options": {
        "source": "docs",
        "keepTime": true,
        "replace": true
      }
    },
    {
      "id": "organize",
      "options": {
        "excludeByName": {
          "_id": true,
          "_index": true,
          "_type": true,
          "highlight": true,
          "sort": true
        },
        "indexByName": {
          "timestamp": 0,
          "host": 1,
          "method": 2,
          "url": 3,
          "status": 4,
          "content": 5
        },
        "renameByName": {
          "timestamp": "Timestamp",
          "host": "Host",
          "method": "Method",
          "url": "URL",
          "status": "Status",
          "content": "Content"
        }
      }
    }
  ],
  "fieldConfig": {
    "defaults": {
      "custom": {
        "align": "left",
        "filterable": true
      },
      "thresholds": { "mode": "absolute", "steps": [] }
    },
    "overrides": [
      {
        "matcher": { "id": "byName", "options": "timestamp" },
        "properties": [
          { "id": "custom.width", "value": 200 },
          { "id": "unit", "value": "dateTimeAsIso" }
        ]
      },
      {
        "matcher": { "id": "byName", "options": "status" },
        "properties": [
          { "id": "custom.width", "value": 100 }
        ]
      }
    ]
  }
},
    {
  "type": "table",
  "title": "Metric Alerts",
  "gridPos": { "x": 0, "y": 44, "w": 24, "h": 10 },
  "targets": [
    {
      "refId": "M",
      "datasource": { "type": "elasticsearch", "uid": "es_metric_alerts" },
      "timeField": "timestamp",
      "query": "*:*",
      "queryType": "lucene",
      "metrics": [
        {
          "type": "raw_document",
          "id": "1"
        }
      ],
      "bucketAggs": []
    }
  ],
  "options": {
    "showHeader": true,
    "cellHeight": "sm",
    "footer": { "show": false }
  },
  "transformations": [
    {
      "id": "extractFields",
      "options": {
        "source": "docs",
        "keepTime": true,
        "replace": true
      }
    },
    {
      "id": "organize",
      "options": {
        "excludeByName": {
          "_id": true,
          "_index": true,
          "_type": true,
          "highlight": true,
          "sort": true
        },
        "indexByName": {
          "timestamp": 0,
          "host": 1,
          "metric": 2,
          "value": 3,
          "threshold": 4,
          "content": 5
        },
        "renameByName": {
          "timestamp": "Timestamp",
          "host": "Host",
          "metric": "Metric",
          "value": "Value",
          "threshold": "Threshold",
          "content": "Content"
        }
      }
    }
  ],
  "fieldConfig": {
    "defaults": {
      "custom": {
        "align": "left",
        "filterable": true
      },
      "thresholds": { "mode": "absolute", "steps": [] }
    },
    "overrides": [
      {
        "matcher": { "id": "byName", "options": "timestamp" },
        "properties": [
          { "id": "custom.width", "value": 200 },
          { "id": "unit", "value": "dateTimeAsIso" }
        ]
      },
      {
        "matcher": { "id": "byName", "options": "value" },
        "properties": [
          { "id": "custom.width", "value": 100 }
        ]
      },
      {
        "matcher": { "id": "byName", "options": "threshold" },
        "properties": [
          { "id": "custom.width", "value": 100 }
        ]
      }
    ]
  }
}
  ]
}
